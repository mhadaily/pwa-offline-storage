<!DOCTYPE html>
<html lang="en">
<head>
	<title>Offline Storage for Progressive Web Applications</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="shower/themes/ribbon/styles/screen-16x10.css">
</head>
<body class="shower full">

	<header class="caption">
		<h1>Offline Storage for Progressive Web Applications</h1>
		<p>Majid Hajian</p>
	</header>

	<section class="slide" id="cover">
		<h2>Offline Storage for <br/>Progressive Web Applications</h2>
		<figure>
			<img class="cover" src="pictures/pwa-sl1.jpg" alt="User working beside Ocean">
			<figcaption class="white">
				<a href="http://www.twitter.com/mhadaily">© Majid Hajian</a>
			</figcaption>
		</figure>
		<style>
			#cover h2 {
				margin:30px 0 0;
				color:#FFF;
				text-align:center;
				font-size:70px;
				}
			#cover p {
				margin:10px 0 0;
				text-align:center;
				color:#FFF;
				font-style:italic;
				font-size:20px;
				}
				#cover p a {
					color:#FFF;
					}
				#cover .cover{
					width: 100%;
				}
				.center {
					text-align: center

				}
				.center h2{
						text-align: center
					}

		</style>
	</section>

	<section class="slide grid">
		<h2>Majid Hajian</h2>
		<div class="double">
		<ol>
			<li>Software Developer</li>
			<li>Passionate about Front-end</li>
			<li>Love building good application</li>
			<li>Open Source Enthusiast </li>
			<li>Glimmer HN PWA Author</li>
		</ol>
			<img style="max-width:100%" src="pictures/mine.jpg">
		</div>
        <p class="center">
			Find me on Gmail / Twitter / Github / Stackoverflow / Linkedin / Medium
		</p>
			<h2 class="center" style="margin-top:-30px">@mhadaily</h3>

	</section>

	<section class="slide center">
		<h2 class="center">But Why Offline Storage?</h2>
		<div class="next center">
			<img src="pictures/magic.gif" width="70%">
		</div>
	</section>

	<section class="slide center">
		<h2>Keep Organized!</h2>
		<img src="pictures/organized.gif" width="60%">
		<h2>...instant retrieval of structured data</h2>
	</section>

	<section class="slide center">
		<h2 class="next">Performance!</h2>
		<video width="420" height="340" autoplay loop>
		<source src="pictures/loading.mp4" type="video/mp4">
		Your browser does not support the video tag.
		</video>
	</section>

	<section class="slide center">
		<div class="double">
		<h2 class="next">Reduce network <br/>requests
		<br><br>
		avoid unneeded data download
		</h2>
		<img src="pictures/traffic.jpg" width="100%">
		</div>
	</section>

	<section class="slide center">
		<h2>...mobile data is not cheap!</h2>
		<img src="pictures/cuba.jpg" width="70%">
	</section>

	<section class="slide center">
		<h2>Server Outage</h2>
		<img src="pictures/so.jpg" width="70%">
	</section>

	<section class="slide">
		<h2>Ok, What are the options?</h2>
		<ol>
		<li>Static Assets
			<ul>
				<li>Application Cache (Part of Service Workers)</li>
			</ul>
		</li>
		<li>Dynamic Content <span  class="next" style="color:red">&#10004;</span>
			<ul>
				<li>Web Storage APIs</li>
				<li>Web SQL Database</li>
				<li>IndexedDB</li>
				<li>File System APIs</li>
				<li>File APIs</li>
				<li>Wrappers & Polyfills!</li>
			</ul>
		</li>
		</ol>
	</section>

	<section class="slide center">
		<h2>Goal</h2>
		<img src="pictures/offline-arch.jpg" width="100%">
	</section>

	<section class="slide center">
		<br><br><br><br>
		<h2 class="shout shrink">‘Offlining’ <br>Dynamic Data</h2>
	</section>


	<section class="slide">
		<h2>Web Storage / localStorage & sessionStorage</h2>
		<ul class="double">
			<li>Pros
			<ul>
				<li>Key / value(strings) pairs</li>
				<li>Persistent on page reloads</li>
				<li>Avoids HTTP overhead of cookies</li>
				<li>Great for storing user preferences</li>
			</ul>
			</li>
			<li class="next">Cons
			<ul>
				<li>5 MB (but really only 2.5 MB)</li>
				<li>Performance (Synchronous)</li>
				<li>No Support for Web Worker</li>
			</ul>
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>Web Storage Compatibility</h2>
		<img src="pictures/webstorage.jpg" width="100%">
	</section>

	<section class="slide">
		<h2>Web Storage Sample Code</h2>
		<pre>
			<code><mark>&lt;script&gt;</mark></code>
			<code>localStorage.<mark class="important">setItem</mark>('User',JSON.stringify({fn:'MJ',id:10}));</code>
			<code>JSON.parse(localStorage.<mark class="important">getItem</mark>('User')); <span class="comment">// Object</span></code>
			<code>localStorage.removeItem('User');</code>
			<code>localStorage.length <span class="comment">// num of items stored</span></code>
			<code>localStorage.key(0); <span class="comment">// 'User'</span></code>
			<code>localStorage.clear();</code>
			<code><mark>&lt;script&gt;</mark></code>
		</pre>
	</section>



	<section class="slide">
		<h2>WebSQL</h2>
		<ul class="double">
			<li>Pros
			<ul>
				<li>Basically wrapper around SQLite</li>
				<li>asynchronous(Callback)</li>
				<li>Transaction-oriented</li>
				<li>Put processing (sorting, filtering, etc.) on client</li>
			</ul>
			</li>
			<li class="next">Cons
			<ul>
				<li>~50MB limit of data storage</li>
				<li>No support for Web Worker</li>
				<li>Depreciated!!
				<img src="pictures/websql.jpg" width="100%"/>
				</li>
			</ul>
			</li>
		</ul>
	</section>



	<section class="slide">
		<style>
			pre.small code{
				font-size:70%
			}
		</style>

		<pre class="small">
			<code><mark>&lt;script&gt;</mark> </code>
		    <code>var db = openDatabase('myDB', '1.0', 'Web SQL DB', 2 * 1024 * 1024, function(db){});</code>
			<code> db.transaction(function (tx) {</code>
			<code> tx.executeSql("CREATE TABLE IF NOT EXISTS..." <span class="comment">// SQL statement.</span></code>
			<code>	 [], <span class="comment">// Parameter array.</span></code>
			<code>	 function onTXSuccess(transaction, results) { ... }, <span class="comment">//opt_successCallback</span></code>
			<code>	 function onTXError(transaction, error) { ... } <span class="comment">//opt_errorCallback</span></code>
			<code> );</code>
			<code> });</code>
			<code class="mark"> var taskText = 'buy groceries';</code>
			<code class="mark"> tx.executeSql(</code>
			<code class="mark"> <mark class="important">'INSERT INTO todo(task, added_on) VALUES (?,?)', [taskText, new Date()], </mark></code>
			<code class="mark"> renderFunc, onError);</code>
			<code><mark>&lt;/script&gt;</mark></code>
		</pre>
	</section>


	<section class="slide">
		<h2>Web SQL Compatibility</h2>
		<img src="pictures/websql-cover.jpg" width="100%">
	</section>

	<section class="slide">
		<h2>IndexedDB</h2>
		<ul class="double">
			<li>Pros (NoSQLDB)
			<ul>
				<li>Object based data store</li>
				<li>“No limit”, can ask user for more space</li>
				<li>For the browser and for Web Workers</li>
				<li>Asynchronous API</li>
				<li>Transaction-oriented</li>
			</ul>
			</li>
			<li class="next">Cons
			<ul>
				<li>Relatively Complex API</li>
				<li>Buggy Implementation in Safari!</li>
			</ul>
			</li>
		</ul>
		<p class="note">Indexed Database API 2.0 is almost there https://hacks.mozilla.org/2016/10/whats-new-in-indexeddb-2-0/</p>
	</section>

	<section class="slide">
		<h2>IndexedDB Compatibility</h2>
		<img src="pictures/indexedb-cov.jpg" width="100%">
	</section>

	<section class="slide">
		<style>
			pre.smaller code{
				font-size:50%
			}
		</style>
		<pre class="smaller">
			<code><mark>&lt;script&gt;</mark></code>
			<code>var open = indexedDB.open("MyDatabase", 1);</code>
			<code>open.onupgradeneeded = function() { <span class="comment">// Create the schema</span></code>
			<code>	var db = open.result;</code>
			<code>	var store = db.createObjectStore("MyObjectStore", {keyPath: "id"});</code>
			<code>	var index = store.createIndex("NameIndex", ["name.last", "name.first"]);</code>
			<code>};</code>

			<code>open.onsuccess = function() {</code>
			<code>	var db = open.result; <span class="comment">// Start a new transaction</span></code>
			<code>	var tx = db.transaction("MyObjectStore", "readwrite");</code>
			<code>	var store = tx.objectStore("MyObjectStore");</code>
			<code>	var index = store.index("NameIndex");</code>
			<code>	<mark>store.put({id: 1, name: {first: "Majid", last: "Hajian"}, age: 30}); </mark><span class="comment">// Add some data</span></code>
			<code class="mark">	var getMajid = store.get(1); <span class="comment">// Query the data</span></code>
			<code class="mark">	getMajid.onsuccess = function() { console.log(getMajid.result.name.first);};  <span class="comment">// => "Majid"</span></code>
			<code>	tx.oncomplete = function() { <span class="comment">// Close the db when the transaction is done</span></code>
			<code>		db.close();</code>
			<code>	};</code>
			<code>}</code>
			<code><mark>&lt;/script&gt;</mark></code>
		</pre>
	</section>

	<section class="slide">
		<h2>File System API (Only Chrome) / File API </h2>
		<style>
			.smLi{font-size:70%}
		</style>
		<ul class="double">
			<li>Focus:
			<ul>
				<li>Asynchronous (callback-based)</li>
				<li>For the browser and for Web Workers</li>
				<li>Large files</li>
				<li>Binary content</li>
			</ul>
			</li>
			<li>Source
			<ul>
				<li class="smLi">https://w3c.github.io/FileAPI/</li>
				<li class="smLi">https://www.w3.org/TR/file-system-api/</li>
				<li class="smLi">https://github.com/WICG/writable-files</li>
				<li class="smLi">https://wicg.github.io/entries-api/</li>
				<li class="smLi">https://github.com/eligrey/FileSaver.js</li>
			</ul>
			</li>
		</ul>
		<p class="note">Just keep an eye on them but they are not going to be in place soon!</p>
	</section>


	<section class="slide center">
		<h2>Goal</h2>
		<img src="pictures/offline-arch.jpg" width="100%">
	</section>

	<section class="slide">
		<h2>We've got a problem?</h2>
		<div class="next center">
			<img src="pictures/browsers.jpg" width="100%">
		</div>
	</section>

	<section class="slide">
		<h2>Wrappers & Polyfills</h2>
		<ul>
			<li class="next"><a href="https://github.com/localForage/localForage">localForage</a> (~8KB, promises,good legacy browser support)</li>
			<li class="next"><a href="https://www.npmjs.com/package/idb-keyval">IDB-keyval</a> (500 byte alternative to localForage, for modern browsers)</li>
			<li class="next"><a href="https://www.npmjs.com/package/idb">IDB-promised</a> (~2k, same IndexedDB API, but with promises)</li>
			<li class="next"><a href="http://dexie.org/">Dexie</a> (~16KB, promises, complex queries, secondary indices)</li>
			<li class="next"><a href="https://pouchdb.com/">PouchDB</a> (~45KB (supports <a href="https://pouchdb.com/2016/06/06/introducing-pouchdb-custom-builds.html">custombuilds</a>),synchronization)</li>
			<li class="next"><a href="https://github.com/google/lovefield">Lovefield</a> (relational)</li>
			<li class="next"><a href="http://lokijs.org/#/">LokiJS</a> (in-memory)</li>
			<li class="next"i><a href="https://github.com/yathit/ydn-db">ydn-db</a> (dexie-like, works with WebSQL)</li>
		</ul>
	</section>


	<section class="slide">
		<h2>Wrappers & Polyfills</h2>
		<ul>
			<li><a href="https://github.com/localForage/localForage">localForage</a> (~8KB, promises,good legacy browser support)</li>
			<li><a href="https://pouchdb.com/">PouchDB</a> (~45KB (supports <a href="https://pouchdb.com/2016/06/06/introducing-pouchdb-custom-builds.html">custombuilds</a>),synchronization)</li>
		</ul>
	</section>

	<footer class="badge">
		<a href="https://github.com/mhadaily/pwa-offline-storage">Fork me on GitHub</a>
	</footer>

	<div class="progress"></div>

	<script src="shower/shower.min.js"></script>
</body>
</html>
